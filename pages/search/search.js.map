{"version":3,"sources":["pages/search/search.js"],"names":["Page","data","title","nearShop","img","name","price","kind","distance","status","grade","searchText","history","chooseHistory","searchShow","cleanHistory","setData","wx","removeStorageSync","chooseTip","e","index","currentTarget","dataset","choose","searchShop","searcheText","type","console","log","detail","value","that","count","unshift","pop","setStorage","key","success","getStorageSync","searchInput","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"search.js","sourcesContent":["// 获取全局应用程序实例对象\n// const app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'search',\n    nearShop: [\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '30',\n        kind: '中国菜',\n        distance: '8.6km',\n        status: '无需排队',\n        grade: 'five-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '30',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'four-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '128',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'one-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '128',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'one-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '128',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'one-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '128',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'one-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '128',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'one-star'\n      },\n      {\n        img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n        name: '青花椒砂锅鱼',\n        price: '128',\n        kind: '中国菜',\n        status: '无需排队',\n        grade: 'one-star'\n      }\n    ],\n    searchText: null,\n    history: [],\n    chooseHistory: null,\n    searchShow: true\n  },\n  /**\n   * 清空搜索记录\n   */\n  cleanHistory () {\n    this.setData({\n      history: [],\n      searchShow: false\n    })\n    wx.removeStorageSync('history')\n  },\n  /**\n   * 改变标签选择\n   * @param e\n   */\n  chooseTip (e) {\n    let index = e.currentTarget.dataset.choose\n    this.setData({\n      chooseHistory: index\n    })\n  },\n  /**\n   * 搜索返回\n   */\n  searchShop (e) {\n    let searcheText = null\n    if (e.currentTarget.dataset.type === 'btn') {\n      // 按钮搜索\n      console.log(this.data.searchText)\n      searcheText = this.data.searchText\n    } else {\n      // 打字框搜索\n      console.log(e.detail.value)\n      searcheText = e.detail.value\n    }\n    let that = this\n    // 设置缓存\n    for (var index of that.data.history) {\n      if (index === searcheText) return\n    }\n    let history = that.data.history\n    console.log(history)\n    if (!history) {\n      history = [searcheText]\n      that.data.history = history\n    } else {\n      let count = history.unshift(searcheText)\n      if (count >= 10) {\n        that.data.history.pop()\n      }\n    }\n    this.setData({\n      chooseHistory: 0,\n      searchShow: true\n    })\n    wx.setStorage({\n      key: 'history',\n      data: that.data.history,\n      success () {\n        that.setData({\n          history: wx.getStorageSync('history')\n        })\n      }\n    })\n  },\n  /**\n   * 键盘输入改变搜索结果\n   */\n  searchInput (e) {\n    console.log(e.detail.value)\n    this.setData({\n      searchText: e.detail.value\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    // 读取搜索历史\n    let history = wx.getStorageSync('history')\n    if (!history) {\n      this.setData({\n        searchShow: false\n      })\n    }\n    this.setData({\n      history: history\n    })\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}